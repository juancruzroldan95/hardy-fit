---
import Layout from "../layouts/Layout.astro";
import SectionContainer from "../components/SectionContainer.astro";
import TipsSection from "../components/TipsSection.astro";
import { Image } from "astro:assets";
import { RECIPES, type RecipeCategory } from "../consts/recipes";
import Clock from "../icons/Clock.astro";
import UsersGroup from "../icons/UsersGroup.astro";
import yellowBgImage from "../assets/images/yellow-bg-image.webp";

const activeRecipes = RECIPES.filter((recipe) => recipe.isActive !== false);

// Extract unique categories
const CATEGORIES: RecipeCategory[] = ["Desayunos y Meriendas", "Pre/Post Entrenamiento"];
---

<Layout
  title="Recetas HARDY"
>
  <main class="pt-16">
    <!-- Hero Section -->
    <SectionContainer
      id="hero"
      class="relative py-16 overflow-hidden"
      noContainer={true}
    >
      <div class="absolute inset-0 bg-neutral-50"></div>
      <div
        class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(195,33,54,0.08),transparent_55%)]"
      >
      </div>
      <div
        class="relative max-w-7xl mx-auto px-6 lg:px-8 text-center scrolling-section opacity-0"
      >
        <h1
          class="text-5xl md:text-6xl font-header font-extrabold text-primary uppercase mb-6"
        >
          Recetas Hardy
        </h1>
        <p class="text-xl text-neutral-700 max-w-3xl mx-auto">
          Descubrí recetas deliciosas y altas en proteína usando HARDY para
          potenciar tu fitness y mejorar tu rendimiento.
        </p>
      </div>
    </SectionContainer>

    <!-- Recipes Grid -->
    <SectionContainer id="recipes" class="py-16 bg-neutral-50">
      <div class="scrolling-section opacity-0">
        <!-- Category Filter Buttons -->
        <div class="category-filters flex flex-col md:flex-row flex-wrap items-center gap-2 pb-6 mb-8 justify-center">
          <span class="font-bold text-neutral-900 md:mr-2">Categorías:</span>
          <div class="flex flex-wrap gap-2 justify-center">
            {
              CATEGORIES.map((category) => (
                <button
                  type="button"
                  class="category-filter-btn px-4 py-2 font-medium rounded-lg transition-colors bg-neutral-100 text-neutral-700 hover:bg-neutral-200"
                  data-category={category}
                >
                  {category}
                </button>
              ))
            }
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
            activeRecipes.map((recipe) => (
              <a
                href={`/receta/${recipe.slug}`}
                class="card bg-white rounded-2xl overflow-hidden ring-1 ring-neutral-200 hover:ring-primary/50 transition-all duration-300 transform hover:scale-[1.02] group"
                data-category={recipe.category}
              >
                <!-- Recipe Image -->
                <div class="aspect-[3/4] overflow-hidden">
                  <Image
                    src={recipe.image}
                    alt={recipe.title}
                    class="w-full h-full object-cover"
                    loading="lazy"
                    quality={80}
                    width={450}
                    height={600}
                  />
                </div>

                <div class="p-6 space-y-4">
                  <div>
                    <h3 class="text-xl font-bold text-neutral-900 mb-2 group-hover:text-primary transition-colors">
                      {recipe.title}
                    </h3>
                    <p class="text-neutral-700 text-sm leading-relaxed line-clamp-2">
                      {recipe.shortDescription}
                    </p>
                  </div>

                  <div class="flex items-center gap-4 text-xs text-neutral-600">
                    {recipe.prepTime && (
                      <div class="flex items-center gap-1">
                        <Clock class="w-4 h-4" />
                        <span>{recipe.prepTime} min</span>
                      </div>
                    )}
                    {recipe.servings && (
                      <div class="flex items-center gap-1">
                        <UsersGroup class="w-4 h-4" />
                        <span>{recipe.servings}</span>
                      </div>
                    )}
                    {recipe.difficulty && (
                      <span class="bg-secondary/20 text-primary px-2 py-1 rounded-full font-semibold">
                        {recipe.difficulty}
                      </span>
                    )}
                  </div>

                  <div class="space-y-2">
                    <h4 class="font-semibold text-neutral-900 text-sm">
                      Productos Hardy:
                    </h4>
                    <div class="flex flex-wrap gap-2">
                      {recipe.productsUsed.slice(0, 2).map((product) => (
                        <span class="text-xs bg-primary/10 text-primary px-3 py-1 rounded-full">
                          {product.replace(" HARDY", "")}
                        </span>
                      ))}
                      {recipe.productsUsed.length > 2 && (
                        <span class="text-xs text-primary">
                          +{recipe.productsUsed.length - 2}
                        </span>
                      )}
                    </div>
                  </div>

                  <button class="w-full bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-full font-semibold uppercase transition-colors group-hover:shadow-lg shadow-md text-sm">
                    Ver Receta Completa
                  </button>
                </div>
              </a>
            ))
          }
        </div>
      </div>
    </SectionContainer>

    <!-- Recipe Tips Section -->
    <SectionContainer id="tips" class="py-24 relative overflow-hidden">
      <!-- Background image -->
      <div class="absolute inset-0">
        <Image
          src={yellowBgImage}
          alt="Hardy Tips background"
          class="w-full h-full object-cover"
          loading="lazy"
          quality={85}
        />
      </div>

      <div class="relative z-10">
        <TipsSection
          titleColor="text-primary"
          descriptionColor="text-black"
          bgColor="bg-secondary-500/80"
          borderColor="ring-secondary-600 hover:ring-secondary-900"
          iconColor="text-primary"
          cardTitleColor="text-primary"
          cardDescriptionColor="text-black"
        />
      </div>
    </SectionContainer>
  </main>
</Layout>

<script is:inline>
  // Category filter functionality
  document.addEventListener("DOMContentLoaded", () => {
    let activeCategory = null;
    const filterButtons = document.querySelectorAll(".category-filter-btn");
    const recipeCards = document.querySelectorAll(".card[data-category]");

    filterButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const category = button.dataset.category;

        if (!category) return;

        // If clicking the same button, remove filter
        if (activeCategory === category) {
          activeCategory = null;
          button.classList.remove("bg-primary", "text-white");
          button.classList.add("bg-neutral-100", "text-neutral-700");

          // Show all cards
          recipeCards.forEach((card) => {
            card.style.display = "";
          });
        } else {
          // Remove active state from all buttons
          filterButtons.forEach((btn) => {
            btn.classList.remove("bg-primary", "text-white");
            btn.classList.add("bg-neutral-100", "text-neutral-700");
          });

          // Set new active state
          activeCategory = category;
          button.classList.remove("bg-neutral-100", "text-neutral-700");
          button.classList.add("bg-primary", "text-white");

          // Filter cards
          recipeCards.forEach((card) => {
            if (card.dataset.category === category) {
              card.style.display = "";
            } else {
              card.style.display = "none";
            }
          });
        }
      });
    });
  });
</script>

<script>
  import { animate, stagger, inView } from "motion";

  const isMobile = window.innerWidth < 768;
  const threshold = isMobile ? 0.02 : 0.08;

  inView(
    ".scrolling-section",
    (element) => {
      animate(
        element,
        { opacity: [0, 1], y: [50, 0] },
        { ease: [0.39, 0.24, 0.3, 1], duration: 1 },
      );

      const cards = element.querySelectorAll(".card");
      if (cards.length > 0) {
        animate(
          cards,
          { opacity: [0, 1], y: [25, 0] },
          { type: "spring", delay: stagger(0.15, { startDelay: 0.25 }) },
        );
      }
    },
    { amount: threshold },
  );
</script>
